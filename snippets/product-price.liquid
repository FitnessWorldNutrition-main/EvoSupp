{% comment %}
    Renders a list of product's price (regular, sale)
    Accepts:
    - product: {Object} Product Liquid object (optional)
    - use_variant: {Boolean} Renders selected or first variant price instead of overall product pricing (optional)
    - price_class: {String} Adds a price class to the price element (optional)
		- show_custom_badges:  {Boolean} Renders custom badges
    Usage:
    {% render 'price', product: product %}
{% endcomment %}
{%- liquid
	if use_variant
    assign target = product.selected_or_first_available_variant
  else
    assign target = product
  endif
  assign price = target.price | default: 1999
	assign available = target.available | default: false

	# HARDCODED 20% DISCOUNT (EVO20)
	# Original price is the current product price
	assign original_price = price
	assign strikethrough_price = original_price
	
	# Calculate 20% discount (80% of original price)
	assign discounted_price = strikethrough_price | times: 80 | divided_by: 100

	# Format prices
	assign money_price = discounted_price | money
	if settings.currency_code_enabled
		assign money_price = discounted_price | money_with_currency
	endif

	if target == product and product.price_varies
    assign money_price = 'products.product.price.from_price_html' | t: price: money_price
  endif
-%}
<span class="price evo-discount-price">
	{%- comment -%} Original price as strikethrough (prix barr√©) - HARDCODED 20% {%- endcomment -%}
	<del>
		<span>
			{% if settings.currency_code_enabled %}
				{{ strikethrough_price | money_with_currency }}
			{% else %}
				{{ strikethrough_price | money }}
			{% endif %}
		</span>
	</del>
	{%- comment -%} Discounted price (current price with 20% off shown) {%- endcomment -%}
	<ins><span class="amount discounted">{{ money_price }}</span></ins>
	<small class="unit-price {% if product.selected_or_first_available_variant.unit_price_measurement == nil %} hidden{% endif %}">
		<span>{{- product.selected_or_first_available_variant.unit_price | money -}}</span>
    <span class="unit-price-separator">/</span>
		<span>
      {%- if product.selected_or_first_available_variant.unit_price_measurement.reference_value != 1 -%}
        {{- product.selected_or_first_available_variant.unit_price_measurement.reference_value -}}
      {%- endif -%}
      {{ product.selected_or_first_available_variant.unit_price_measurement.reference_unit }}
    </span>
	</small>
	{%- if show_badges -%}
		<span class="badges">
			{%- comment -%} Discount badge - HARDCODED 20% discount {%- endcomment -%}
			{%- assign saved_amount = strikethrough_price | minus: discounted_price | money -%}
			{%- capture saved_percent -%}20%{%- endcapture -%}
			<span class="badge onsale">
				{%- if settings.sale_badge_type == 'sale' -%}
				{{ 'products.product.on_sale' | t }}
				{%- elsif settings.sale_badge_type == 'save_amount' -%}
				{{ 'products.product.save_html' | t: saved_amount: saved_amount }}
				{%- else -%}
				{{ 'products.product.save_html' | t: saved_amount: saved_percent }}
				{%- endif -%}
			</span>
			{%- if available == false -%}
		  <span class="badge out-of-stock">
		    {{ 'products.product.sold_out' | t }}
		  </span>
			{% endif %}
			{%- if product.metafields.theme.preorder and product.available -%}
			<span class="badge pre-order">
				{{ 'products.product.pre_order' | t }}
			</span>
			{%- endif -%}
			{%- if show_custom_badges -%}
				{%- liquid
					# Custom badges
					assign product_tags = product.tags
					assign badge_tags_1 = settings.custom_product_badge_group_1_tag_names | split: ', '
					assign badge_tags_2 = settings.custom_product_badge_group_2_tag_names | split: ', '
					assign badge_tags_3 = settings.custom_product_badge_group_3_tag_names | split: ', '
					assign badge_tags_4 = settings.custom_product_badge_group_4_tag_names | split: ', '
					assign badge_tags = badge_tags_1 | concat: badge_tags_2 | concat: badge_tags_3 | concat: badge_tags_4
				-%}
				{%- for badge_tag in badge_tags -%}
					{%- for product_tag in product_tags -%}
						{%- assign product_tag_lower = product_tag | downcase -%}
						{%- assign badge_tag_lower = badge_tag | downcase -%}
						{%- if product_tag_lower == badge_tag_lower -%}
							{%- capture custom_badges -%}
								{{ custom_badges }}
								<div class="badge {{ badge_tag_lower | handleize }}" data-badge="{{ badge_tag_lower | handleize }}">
									{{ badge_tag }}
								</div>
							{%- endcapture -%}
						{%- endif -%}
					{%- endfor -%}
				{%- endfor -%}
				{{ custom_badges }}
			{%- endif -%}
		</span>
	{% endif %}
</span>
