{% comment %}
    Renders a list of product's price (regular, sale)
    Accepts:
    - product: {Object} Product Liquid object (optional)
    - use_variant: {Boolean} Renders selected or first variant price instead of overall product pricing (optional)
    - price_class: {String} Adds a price class to the price element (optional)
		- show_custom_badges:  {Boolean} Renders custom badges
    Usage:
    {% render 'price', product: product %}
{% endcomment %}
{%- liquid
	if use_variant
    assign target = product.selected_or_first_available_variant
  else
    assign target = product
  endif
  assign compare_at_price = target.compare_at_price
  assign price = target.price | default: 1999
	assign available = target.available | default: false

	# EVO20 discount: 20% off
	assign evo_discount_percent = 20
	assign evo_discounted_price = price | times: 80 | divided_by: 100
	assign evo_original_price = price

	# Format the discounted price
	assign money_price = evo_discounted_price | money
	if settings.currency_code_enabled
		assign money_price = evo_discounted_price | money_with_currency
	endif

	if target == product and product.price_varies
    assign money_price = 'products.product.price.from_price_html' | t: price: money_price
  endif

	# Always show as discounted since EVO20 is always applied
	assign discounted_class = 'discounted'
-%}
<span class="price evo-discount-price">
	{%- comment -%} Discounted price on the left {%- endcomment -%}
	<ins><span class="amount {{ discounted_class }}">{{ money_price }}</span></ins>
	{%- comment -%} Original price as strikethrough (prix barr√©) on the right {%- endcomment -%}
	<del>
		<span class="amount">
			{% if settings.currency_code_enabled %}
				{{ evo_original_price | money_with_currency }}
			{% else %}
				{{ evo_original_price | money }}
			{% endif %}
		</span>
	</del>
	<small class="unit-price {% if product.selected_or_first_available_variant.unit_price_measurement == nil %} hidden{% endif %}">
		<span>{{- product.selected_or_first_available_variant.unit_price | money -}}</span>
    <span class="unit-price-separator">/</span>
		<span>
      {%- if product.selected_or_first_available_variant.unit_price_measurement.reference_value != 1 -%}
        {{- product.selected_or_first_available_variant.unit_price_measurement.reference_value -}}
      {%- endif -%}
      {{ product.selected_or_first_available_variant.unit_price_measurement.reference_unit }}
    </span>
	</small>
	{%- if show_badges -%}
		<span class="badges">
			{%- comment -%} EVO20 discount badge - always show 20% off {%- endcomment -%}
			{%- assign evo_saved_amount = evo_original_price | minus: evo_discounted_price | money -%}
			<span class="badge onsale">
				{%- if settings.sale_badge_type == 'sale' -%}
				{{ 'products.product.on_sale' | t }}
				{%- elsif settings.sale_badge_type == 'save_amount' -%}
				{{ 'products.product.save_html' | t: saved_amount: evo_saved_amount }}
				{%- else -%}
				{{ 'products.product.save_html' | t: saved_amount: '20%' }}
				{%- endif -%}
			</span>
			{%- if available == false -%}
		  <span class="badge out-of-stock">
		    {{ 'products.product.sold_out' | t }}
		  </span>
			{% endif %}
			{%- if product.metafields.theme.preorder and product.available -%}
			<span class="badge pre-order">
				{{ 'products.product.pre_order' | t }}
			</span>
			{%- endif -%}
			{%- if show_custom_badges -%}
				{%- liquid
					# Custom badges
					assign product_tags = product.tags
					assign badge_tags_1 = settings.custom_product_badge_group_1_tag_names | split: ', '
					assign badge_tags_2 = settings.custom_product_badge_group_2_tag_names | split: ', '
					assign badge_tags_3 = settings.custom_product_badge_group_3_tag_names | split: ', '
					assign badge_tags_4 = settings.custom_product_badge_group_4_tag_names | split: ', '
					assign badge_tags = badge_tags_1 | concat: badge_tags_2 | concat: badge_tags_3 | concat: badge_tags_4
				-%}
				{%- for badge_tag in badge_tags -%}
					{%- for product_tag in product_tags -%}
						{%- assign product_tag_lower = product_tag | downcase -%}
						{%- assign badge_tag_lower = badge_tag | downcase -%}
						{%- if product_tag_lower == badge_tag_lower -%}
							{%- capture custom_badges -%}
								{{ custom_badges }}
								<div class="badge {{ badge_tag_lower | handleize }}" data-badge="{{ badge_tag_lower | handleize }}">
									{{ badge_tag }}
								</div>
							{%- endcapture -%}
						{%- endif -%}
					{%- endfor -%}
				{%- endfor -%}
				{{ custom_badges }}
			{%- endif -%}
		</span>
	{% endif %}
</span>
